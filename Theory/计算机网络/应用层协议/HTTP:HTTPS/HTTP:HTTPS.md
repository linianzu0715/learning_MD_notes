## HTTP

#### URL组成结构

以下面这个URL为例，介绍下普通URL的各部分组成：

http://www.aspxfans.com:8080/news/index.asp?boardID=5&ID=24618&page=1#name

1. 协议部分：该URL的协议部分为“http：”，这代表网页使用的是HTTP协议。在Internet中可以使用多种协议，如HTTP，FTP等等本例中使用的是HTTP协议。在"HTTP"后面的“//”为分隔符

2. 域名部分：该URL的域名部分为“www.aspxfans.com”。一个URL中，也可以使用IP地址作为域名使用。
3. 端口部分：跟在域名后面的是端口，域名和端口之间使用“:”作为分隔符。端口不是一个URL必须的部分。http协议的默认端口是80，https协议的默认端口是443。
4. 虚拟目录部分：从域名后的第一个“/”开始到最后一个“/”为止，是虚拟目录部分。虚拟目录也不是一个URL必须的部分。本例中的虚拟目录是“/news/”。
5. 文件名部分：从域名后的最后一个“/”开始到“？”为止，是文件名部分，如果没有“?”,则是从域名后的最后一个“/”开始到“#”为止，是文件部分，如果没有“？”和“#”，那么从域名后的最后一个“/”开始到结束，都是文件名部分。本例中的文件名是“index.asp”。文件名部分也不是一个URL必须的部分，如果省略该部分，则使用默认的文件名
6. 锚部分：从“#”开始到最后，都是锚部分。本例中的锚部分是“name”。锚部分也不是一个URL必须的部分
7. 参数部分：从“？”开始到“#”为止之间的部分为参数部分，又称搜索部分、查询部分。本例中的参数部分为“boardID=5&ID=24618&page=1”。参数可以允许有多个参数，参数与参数之间用“&”作为分隔符。



#### HTTP方法

|  方法   | 说明                                                         |
| :-----: | :----------------------------------------------------------- |
| OPTIONS | 返回服务器针对特定资源所支持的HTTP请求方法                   |
|  HEAD   | 向服务器索要和GET请求相一致的响应，只不过响应体将不会被返回。这一方法可以在不必传输整个响应内容的情况家，就可以获取包含在响应消息头中的元信息 |
|   GET   | 向特定的资源发出请求                                         |
|  POST   | 向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的创建或者已有资源的修改。 |
|   PUT   | 向指定资源位置上传新的内容                                   |
| DELETE  | 请求服务器删除REQUEST-URL所标识的资源                        |
|  TRACE  | 回显服务器收到的请求，只要用于测试或者诊断                   |
| CONNECT | HTTP/1.1协议中预留给能够将连接改造为管道方式的代理服务器。   |



#### HTTP请求头和响应头

HTTP 请求报文由3部分组成(请求行+请求头+请求体)



##### HTTP请求报文：

1. 是请求方法,GET和POST是最常见的HTTP方法,初次以外还包括 DELETE、HEAD、OPTIONS、PUT、TRACE，不过现在大部分的浏览器只支持GET和POST

2. 是请求对应的URL地址,他和报文头的Host属性,组合起来是一个完整的请求URL

3. 是协议民称和版本号

4. 是报文头,有若干个属性,形式为key:val,服务端据此获取客户端信息

5. 是报文体,它将一个页面表单中的组件值通过param1=val1&parma=2的键值对形式编码成一个格式化串,它承载多个请求参数的数据,不但报文头可以传递请求参数,URL也可以通过/chapter15/user.html? param1=value1&param2=value2”的方式传递数值

##### HTTP请求报文头属性:

- Accpet:告诉服务端,客户端接收什么类型的响应
- Referer: 表示这是请求是从哪个URL进来的,比如想在网上购物,但是不知道选择哪家电商平台,你就去问度娘,说哪家电商的东西便宜啊,然后一堆东西弹出在你面前,第一给就是某宝,当你从这里进入某宝的时候,这个请求报文的Referer就是

- Cache-Control: 对缓存进行控制,如一个请求希望响应的内容在客户端缓存一年,或不被缓可以通过这个报文头设置

- Accept-Encoding: 这个属性是用来告诉服务器能接受什么编码格式,包括字符编码,压缩形式(一般都是压缩形式) 例如:Accept-Encoding:gzip, deflate(这两种都是压缩格式)

- Host: 指定要请求的资源所在的主机和端口
- User-Agent：告诉服务器，客户端使用的操作系统、浏览器版本和名称

##### HTTP响应报文：

响应报文与请求报文一样,由三个部分组成(响应行,响应头,响应体)

![HTTP2](/Users/linianzu/Documents/learning_MD_notes/Picture/HTTP2.png)

1. 报文协议及版本；
2. 状态码及状态描述；
3. 响应报文头，也是由多个属性组成；
4. 响应报文体，即我们要的数据。

##### HTTP响应报文属性

- Cache-Control: 响应输出到客户端后,服务端通过该属性告诉客户端该怎么控制响应内容的缓存
- ETag: 表示你请求资源的版本,如果该资源发生啦变化,那么这个属性也会跟着变
- Location: 在重定向中或者创建新资源时使用
- Set-Cookie: 服务端可以设置客户端的cookie



#### HTTP状态码:

##### HTTP状态码分类：

| 分类 | 分类描述                                       |
| :--: | :--------------------------------------------- |
| 1**  | 信息，服务器收到请求，需要请求者继续执行操作   |
| 2**  | 成功，操作被成功接收并处理                     |
| 3**  | 重定向，需要进一步的操作以完成请求             |
| 4**  | 客户端错误，请求包含语法错误或无法完成请求     |
| 5**  | 服务器错误，服务器在处理请求的过程中发生了错误 |

##### 常见的HTTP状态码：

| 状态码 |               解释                |
| :----: | :-------------------------------: |
|  200   |             请求成功              |
|  301   | 资源（网页等）被永久转移到其它URL |
|  404   |    请求的资源（网页等）不存在     |
|  500   |          内部服务器错误           |



#### HTTP的长连接和短连接

HTTP的长连接和短连接本质上是TCP长连接和短连接。HTTP属于应用层协议.

**短连接**:浏览器和服务器每进行一次HTTP操作，就建立一次连接，但任务结束就中断连接。

**长连接**:当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的 TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。实现长连接要客户端和服务端都支持长连接。

**TCP短连接:** client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起 close操作.短连接一般只会在client/server间传递一次读写操作

**TCP长连接:** client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。



#### POST和GET请求的区别

http请求方式有get、post、put、delete等多种，最常用的就是get和post。

区别：

1. GET请求一般用去请求获取数据， POST一般作为发送数据到后台时使用。
2. GET请求也可传参到后台，但是其参数在浏览器的地址栏的url中可见，所以隐私性安全性较差，且参数长度也是有限制的。POST请求传递参数放在Request body中，不会在url中显示，比GET要安全，且参数长度无限制。
3. GET请求刷新浏览器或回退时没有影响，POST回退时会重新提交数据请求。
4. GET请求可被缓存，POST 请求不会被缓存
5. GET 请求保留在浏览器历史记录中，POST 请求不会保留在浏览器历史记录中。
6. GET 请求可被收藏为书签， POST 不能被收藏为书签
7. GET请求只能进行url编码（application/x-www-form-urlencoded），POST支持多种编码方式（application/x-www-form-urlencoded 或 multipart/form-data。为二进制数据使用多重编码）
8. GET请求比较常见的方式是通过url地址栏请求，POST最常见是通过form表单发送数据请求

HTTP是基于TCP/IP的关于数据如何在万维网中如何通信的协议。HTTP的底层是TCP/IP。所以GET和POST的底层也是TCP/IP，也就是说，GET/POST都是TCP链接。GET和POST能做的事情是一样一样的。你要给GET加上request body，给POST带上url参数，技术上是完全行的通的。 

GET和POST还有一个重大区别，简单的说：GET产生一个TCP数据包；POST产生两个TCP数据包。对于GET方式的请求，浏览器会把http header和data一并发送出去，服务器响应200（返回数据）；而对于POST，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok（返回数据）。

1. GET与POST都有自己的语义，不能随便混用。

2. 据研究，在网络环境好的情况下，发一次包的时间和发两次包的时间差别基本可以无视。而在网络环境差的情况下，两次包的TCP在验证数据包完整性上，有非常大的优点。

3. 并不是所有浏览器都会在POST中发送两次包，Firefox就只发送一次。



#### HTTP和HTTPS

超文本传输协议HTTP协议被用于在Web浏览器和网站服务器之间传递信息，HTTP协议以明文方式发送内容，不提供任何方式的数据加密，如果攻击者截取了Web浏览器和网站服务器之间的传输报文，就可以直接读懂其中的信息，因此，HTTP协议不适合传输一些敏感信息，比如：信用卡号、密码等支付信息。

为了解决HTTP协议的这一缺陷，需要使用另一种协议：安全套接字层超文本传输协议HTTPS，为了数据传输的安全，HTTPS在HTTP的基础上加入了SSL协议，SSL依靠证书来验证服务器的身份，并为浏览器和服务器之间的通信加密。

**一、HTTP和HTTPS的基本概念**

* HTTP：是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。
* HTTPS：是以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。

HTTPS协议的主要作用可以分为两种：一种是建立一个信息安全通道，来保证数据传输的安全；另一种就是确认网站的真实性。



**二、HTTP有什么缺点？**

* 通信使用明文，内容有可能被窃听（重要密码泄露）
* 不验证通信方身份，有可能遭遇伪装（跨站点请求伪装）
* 无法证明报文的完整性，有可能已经遭到篡改（运营商劫持）



**三、HTTP与HTTPS有什么区别？**

HTTP协议传输的数据都是未加密的，也就是明文的，因此使用HTTP协议传输隐私信息非常不安全，为了保证这些隐私数据能加密传输，于是网景公司设计了SSL（Secure Sockets Layer）协议用于对HTTP协议传输的数据进行加密，从而就诞生了HTTPS。简单来说，HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全。

HTTPS和HTTP的区别主要如下：

1. https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。

2. http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。

3. http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。

4. http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

| HTTP | HTTP |
| :--: | :--: |
| TCP  | SSL  |
|  IP  | TCP  |
|      |  IP  |

**四、SSL**

SSL是"Secure Sockets Layer"的缩写，中文叫做”安全套接层“。原先互联网上使用的HTTP协议是明文的，存在安全性风险。SSL解决这个问题。

SSL协议位于TCP/IP协议和各种应用层协议之间，为数据通信提供安全支持。SSL协议可以分成两层：

* SSL记录协议（SSL RECORD PROTOCOL):它简历在可靠的传输协议（如TCP）之上，为高层协议提供数据封装，压缩，加密等基本的支持
* SSL握手协议（SSL HANDSHAKE PROTOCOL):它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证，协商加密算法，交换加密密钥等。



**五、对称密钥加密和非对称密钥加密**

对称密钥加密，又称之为私钥加密，即信息的发送放和接收方用同一个密钥去加密和解密数据，优点是加密/解密的速度快，适合于对大数据量进行加密，但是密钥管理复杂。

非对称密钥加密，又称为公钥加密，它是要使用一对密钥来分别完成加密和解密操作，一个公开发布，即公开密钥，另一个又用户自己秘密保存，即私用密钥。信息发送者用公开密钥去加密，而信息接受者用私用密钥去解密。从功能角度看，非对称加密比对称加密强大，但是加密和解密的速度慢。



**六、HTTPS工作原理**

客户端在使用HTTPS方式与Web服务器通信时有以下几个步骤，如图所示。

1. 客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接。
2. Web服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端。
3. 客户端的浏览器与Web服务器开始协商SSL连接的安全等级，也就是信息加密的等级。
4. 客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站。
5. Web服务器利用自己的私钥解密出会话密钥。
6. Web服务器利用会话密钥加密与客户端之间的通信。



#### HTTP和TCP的关联

1. TCP是底层通讯协议，定义的是数据传输和连接方式的规范
2. HTTP是应用层协议，定义的是传输数据的内容的规范
3. HTTP协议中的数据是利用TCP协议传输的，所以支持HTTP也就一定支持TCP   